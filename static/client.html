<!doctype html>
<html>
  <body>
    <h1>Camera Stream</h1>
    <input id="camid" value="phone-1"/>
    <button id="start">Start</button>
    <p></p>
    <video id="preview" autoplay playsinline muted></video>
    <script>
      const $ = id => document.getElementById(id);
      let pc, stream;

      async function start() {
        stream = await navigator.mediaDevices.getUserMedia({video: true, audio: false});
        $("preview").srcObject = stream;
        pc = new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});
        stream.getTracks().forEach(t => pc.addTrack(t, stream));

        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);

        const resp = await fetch("/offer", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({sdp: offer.sdp, type: offer.type, camId:$("camid").value})
        });
        const answer = await resp.json();
        await pc.setRemoteDescription(answer);
      }
      $("start").onclick = start;
    </script>
  </body>
</html>
